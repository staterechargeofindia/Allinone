<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ISI ‚Äì Merchant Orders</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="css/style.css">

<style>
.order-card{
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
.order-id{
  font-weight:800;
  margin-bottom:6px;
}
.order-item{
  font-size:14px;
  margin-bottom:6px;
}
.order-item b{
  font-weight:700;
}
.order-date{
  font-size:13px;
  color:#6b7280;
  margin-bottom:8px;
}
.empty{
  text-align:center;
  padding:40px;
  color:#6b7280;
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="topbar">
  <div onclick="history.back()">‚Üê</div>
  <div>Merchant Orders</div>
  <div onclick="goHome()">üè†</div>
</header>

<div class="container" id="orderList"></div>

<!-- JS -->
<script src="js/data.js"></script>

<script>
function goHome(){ location.href="index.html"; }

/* ---------- auth check ---------- */
const merchant = JSON.parse(localStorage.getItem("merchantSession"));
if(!merchant){
  location.href="merchant-login.html";
}

/* ---------- load orders ---------- */
const orders = getData("orders");
let merchantOrders = [];

/*
  Filter orders:
  keep only those orders where
  at least one item belongs to this merchant
*/
orders.forEach(order=>{
  const items = order.items.filter(
    item => item.merchantId === merchant.id
  );

  if(items.length > 0){
    merchantOrders.push({
      id: order.id,
      date: order.date,
      payment: order.payment,
      address: order.address,
      items: items
    });
  }
});

/* ---------- render ---------- */
if(merchantOrders.length === 0){

  orderList.innerHTML =
    `<div class="empty">No orders received yet</div>`;

}else{

  merchantOrders.slice().reverse().forEach(order=>{

    const card = document.createElement("div");
    card.className = "order-card";

    card.innerHTML = `
      <div class="order-id">Order ID: ${order.id}</div>
      <div class="order-date">${order.date}</div>

      <div class="order-item">
        <b>Payment:</b> ${order.payment.toUpperCase()}
      </div>

      <div class="order-item">
        <b>Customer:</b><br>
        ${order.address.name}<br>
        ${order.address.mobile}<br>
        ${order.address.address}<br>
        ${order.address.district}, ${order.address.state} - ${order.address.pincode}
      </div>

      <div class="order-item">
        <b>Ordered Items:</b>
        <ul>
          ${order.items.map(i=>`
            <li>${i.name} √ó ${i.qty || 1}</li>
          `).join("")}
        </ul>
      </div>
    `;

    orderList.appendChild(card);
  });
}
</script>

</body>
</html>
